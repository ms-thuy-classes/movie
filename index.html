<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Learn Vocabulary Through Movie</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
body{margin:0;font-family:Poppins,sans-serif;background:linear-gradient(135deg,#fde2e4,#e0f2fe)}
.container{display:grid;grid-template-columns:1fr 1fr;gap:20px;padding:20px;max-width:1400px;margin:auto}
.card{background:#fff;border-radius:20px;padding:15px;box-shadow:0 10px 30px rgba(0,0,0,.15)}
.subtitle-box{max-height:420px;overflow-y:auto}
.subtitle-line{padding:8px 12px;border-radius:10px;margin-bottom:6px;cursor:pointer}
.subtitle-line.active{background:linear-gradient(90deg,#a5f3fc,#fbcfe8);font-weight:600}
.audio-controls{display:flex;gap:10px;margin:10px 0}
button{border:none;border-radius:30px;padding:8px 16px;background:linear-gradient(90deg,#a5f3fc,#fbcfe8);cursor:pointer}
.quiz{grid-column:1/3}
input.blank{border:none;border-bottom:2px solid #555;outline:none;width:120px;font-size:16px}
</style>
</head>
<body>

<div class="container">

  <!-- VIDEO (XEM) -->
  <div class="card">
    <iframe src="https://drive.google.com/file/d/1luLOxU-Vya_yTp678JZPVeCp0ebFbLfN/preview"
      width="100%" height="420" allow="autoplay" allowfullscreen></iframe>
  </div>

  <!-- AUDIO + SUBTITLE -->
  <div class="card">
    <audio id="audio" controls src="https://docs.google.com/uc?export=download&id=1IoFqpqm46CqELbRYBebVRBxK_oqhr_Dr"></audio>
    <div class="audio-controls">
      <button onclick="audio.currentTime-=5">‚è™ 5s</button>
      <button onclick="audio.currentTime+=5">‚è© 5s</button>
    </div>
    <div class="subtitle-box" id="subtitleBox"></div>
  </div>

  <!-- QUIZ -->
  <div class="card quiz">
    <h2>üìù Vocabulary Quiz</h2>
    <div id="quizBox"></div>
    <button onclick="gradeQuiz()">Ch·∫•m ƒëi·ªÉm</button>
    <p id="result"></p>
  </div>

</div>

<script>
let subtitles=[];

function toSec(t){
  const [h,m,s,ms]=t.replace(',',':').split(':');
  return +h*3600 + +m*60 + +s + ms/1000;
}

async function loadSRT(){
  const res=await fetch('subtitles/story.srt');
  const text=await res.text();
  subtitles=text.trim().split(/\n\n+/).map(b=>{
    const l=b.split('\n');
    const t=l[1].split(' --> ');
    return{start:toSec(t[0]),end:toSec(t[1]),text:l.slice(2).join(' ')};
  });

  const box=document.getElementById('subtitleBox');
  subtitles.forEach((s,i)=>{
    const d=document.createElement('div');
    d.className='subtitle-line';
    d.id='line'+i;
    d.innerText=s.text;
    d.onclick=()=>audio.currentTime=s.start;
    box.appendChild(d);
  });

  buildQuiz();
}

const audio=document.getElementById('audio');
audio.addEventListener('timeupdate',()=>{
  const t=audio.currentTime;
  subtitles.forEach((s,i)=>{
    const l=document.getElementById('line'+i);
    if(t>=s.start && t<=s.end){
      l.classList.add('active');
      l.scrollIntoView({behavior:'smooth',block:'center'});
    } else l.classList.remove('active');
  });
});

function buildQuiz(){
  const quizBox=document.getElementById('quizBox');
  quizBox.innerHTML='';
  subtitles.slice(0,30).forEach((s,i)=>{
    const words=s.text.split(' ');
    const key=words.find(w=>w.length>6) || words[0];
    const q=s.text.replace(key,'_____');
    quizBox.innerHTML+=`<p>${i+1}. ${q}<br><input class="blank" data-answer="${key.toLowerCase()}"></p>`;
  });
}

function gradeQuiz(){
  let score=0;
  document.querySelectorAll('.blank').forEach(i=>{
    if(i.value.toLowerCase().trim()===i.dataset.answer) score++;
  });
  result.innerText=`ƒêi·ªÉm: ${score}/${document.querySelectorAll('.blank').length}`;
}

loadSRT();
</script>

</body>
</html>
